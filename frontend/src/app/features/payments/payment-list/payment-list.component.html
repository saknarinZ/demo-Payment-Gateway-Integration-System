<div class="payment-list-container">
  <!-- Header Section -->
  <header class="page-header">
    <div class="header-left">
      <h1 class="page-title">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Payment</h1>
      <p class="page-subtitle">
        ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î {{ paymentService.totalElements() }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
      </p>
    </div>
    <div class="header-right">
      <a routerLink="/create-payment" class="btn btn-primary">
        + ‡∏™‡∏£‡πâ‡∏≤‡∏á Payment ‡πÉ‡∏´‡∏°‡πà
      </a>
    </div>
  </header>

  <!-- Filter Section -->
  <section class="filter-section">
    <div class="filter-group search-group">
      <label class="filter-label">Search:</label>
      <input
        type="text"
        class="filter-input"
        placeholder="Reference ID, Name, Email"
        [ngModel]="searchQuery()"
        (ngModelChange)="onSearch($event)"
      />
    </div>

    <div class="filter-group">
      <label class="filter-label">Filter by Status:</label>
      <select
        class="filter-select"
        [ngModel]="selectedStatus()"
        (ngModelChange)="onStatusFilterChange($event)"
      >
        <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
        @for (status of statusOptions; track status) {
        <option [value]="status">{{ getStatusLabel(status) }}</option>
        }
      </select>
    </div>

    <div class="filter-group">
      <button class="btn btn-secondary" (click)="refreshPayments()">
        üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
      </button>
    </div>
  </section>

  <!-- Loading State -->
  @if (paymentService.loading()) {
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
  </div>
  }

  <!-- Error State -->
  @if (paymentService.error()) {
  <div class="error-container">
    <p class="error-message">‚ùå {{ paymentService.error() }}</p>
    <button class="btn btn-primary" (click)="refreshPayments()">
      ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
    </button>
  </div>
  }

  <!-- Payment Table -->
  @if (!paymentService.loading() && !paymentService.error()) { @if
  (paymentService.payments().length > 0) {
  <div class="table-container">
    <table class="payment-table">
      <thead>
        <tr>
          <th>Reference ID</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
          <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
          <th>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</th>
          <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
          <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á</th>
          <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody>
        @for (payment of paymentService.payments(); track payment.referenceId) {
        <tr>
          <td class="ref-id">
            <a [routerLink]="['/payments', payment.referenceId]">
              {{ payment.referenceId }}
            </a>
          </td>
          <td>{{ payment.customerName }}</td>
          <td class="amount">
            {{ formatAmount(payment.amount, payment.currency) }}
          </td>
          <td>
            <span class="method-badge">
              {{ getPaymentMethodLabel(payment.paymentMethod) }}
            </span>
          </td>
          <td>
            <span
              class="status-badge"
              [class]="'status-' + payment.status.toLowerCase()"
            >
              {{ getStatusLabel(payment.status) }}
            </span>
          </td>
          <td>{{ formatDate(payment.createdAt) }}</td>
          <td class="actions">
            <a
              [routerLink]="['/payments', payment.referenceId]"
              class="btn btn-sm btn-outline"
              title="‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"
            >
              üëÅÔ∏è
            </a>
            @if (payment.status === 'PENDING') {
            <button
              class="btn btn-sm btn-success"
              (click)="completePayment(payment.referenceId)"
              title="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô"
            >
              ‚úì
            </button>
            <button
              class="btn btn-sm btn-danger"
              (click)="cancelPayment(payment.referenceId)"
              title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
            >
              ‚úï
            </button>
            }
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  @if (paymentService.totalPages() > 1) {
  <div class="pagination">
    <button
      class="btn btn-sm btn-outline"
      [disabled]="paymentService.currentPage() === 0"
      (click)="goToPage(paymentService.currentPage() - 1)"
    >
      ‚Üê ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
    </button>

    <div class="page-info">
      ‡∏´‡∏ô‡πâ‡∏≤ {{ paymentService.currentPage() + 1 }} ‡∏à‡∏≤‡∏Å
      {{ paymentService.totalPages() }}
    </div>

    <button
      class="btn btn-sm btn-outline"
      [disabled]="
        paymentService.currentPage() >= paymentService.totalPages() - 1
      "
      (click)="goToPage(paymentService.currentPage() + 1)"
    >
      ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí
    </button>
  </div>
  } } @else {
  <!-- Empty State -->
  <div class="empty-state">
    <div class="empty-icon">üìã</div>
    <h3>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Payment</h3>
    <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Payment ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
    <a routerLink="/create-payment" class="btn btn-primary">
      ‡∏™‡∏£‡πâ‡∏≤‡∏á Payment ‡πÅ‡∏£‡∏Å
    </a>
  </div>
  } }
</div>
